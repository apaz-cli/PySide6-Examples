<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>PerfWizard - Monaco Editor</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            overflow: hidden;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: transparent;
        }
        #container {
            width: 100vw;
            height: 100vh;
            background: transparent;
        }
        .loading {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            height: 100vh;
            color: #666;
            gap: 20px;
            background: transparent;
        }
        .spinner {
            width: 30px;
            height: 30px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #007acc;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div id="container">
        <div class="loading">
            <div class="spinner"></div>
            <div>Loading Monaco Editor...</div>
        </div>
    </div>
    
    <script src="qrc:///qtwebchannel/qwebchannel.js"></script>
    <script>
        let editor;
        let monacoInterface;
        
        // Initialize Qt Web Channel
        new QWebChannel(qt.webChannelTransport, function(channel) {
            monacoInterface = channel.objects.monaco_interface;
        });
        
        // Load Monaco Editor
        async function initMonaco() {
            try {
                // Load Monaco loader
                await loadScript('MONACO_PATH_PLACEHOLDER/min/vs/loader.js');
                
                // Configure require paths
                require.config({ 
                    paths: { 
                        'vs': 'MONACO_PATH_PLACEHOLDER/min/vs' 
                    }
                });
                
                // Load Monaco editor
                require(['vs/editor/editor.main'], function() {
                    // Clear loading message
                    document.getElementById('container').innerHTML = '';
                    
                    // Define transparent themes
                    monaco.editor.defineTheme('transparent-dark', {
                        base: 'vs-dark',
                        inherit: true,
                        rules: [],
                        colors: {
                            'editor.background': '#00000000',
                            'editor.lineHighlightBackground': '#ffffff08',
                            'editorLineNumber.foreground': '#858585',
                            'editorGutter.background': '#00000000',
                            'editorWidget.background': '#2d2d30cc',
                            'editorSuggestWidget.background': '#2d2d30cc',
                            'editorHoverWidget.background': '#2d2d30cc',
                            'scrollbar.shadow': '#00000000',
                            'scrollbarSlider.background': '#ffffff20',
                            'scrollbarSlider.hoverBackground': '#ffffff40',
                            'scrollbarSlider.activeBackground': '#ffffff60',
                            'minimap.background': '#00000000',
                            'minimapSlider.background': '#ffffff20',
                            'minimapSlider.hoverBackground': '#ffffff40',
                            'minimapSlider.activeBackground': '#ffffff60'
                        }
                    });
                    
                    monaco.editor.defineTheme('transparent-light', {
                        base: 'vs',
                        inherit: true,
                        rules: [],
                        colors: {
                            'editor.background': '#00000000',
                            'editor.lineHighlightBackground': '#00000008',
                            'editorLineNumber.foreground': '#237893',
                            'editorGutter.background': '#00000000',
                            'editorWidget.background': '#f3f3f3cc',
                            'editorSuggestWidget.background': '#f3f3f3cc',
                            'editorHoverWidget.background': '#f3f3f3cc',
                            'scrollbar.shadow': '#00000000',
                            'scrollbarSlider.background': '#00000020',
                            'scrollbarSlider.hoverBackground': '#00000040',
                            'scrollbarSlider.activeBackground': '#00000060',
                            'minimap.background': '#00000000',
                            'minimapSlider.background': '#00000020',
                            'minimapSlider.hoverBackground': '#00000040',
                            'minimapSlider.activeBackground': '#00000060'
                        }
                    });
                    
                    // Create editor
                    editor = monaco.editor.create(document.getElementById('container'), {
                        value: '',
                        language: 'javascript',
                        theme: 'INITIAL_THEME_PLACEHOLDER',
                        automaticLayout: true,
                        fontSize: 15,
                        fontFamily: 'FONT_FAMILY_PLACEHOLDER, monospace',
                        minimap: { enabled: true },
                        scrollBeyondLastLine: false,
                        wordWrap: 'on',
                        lineNumbers: 'on',
                        folding: true,
                        formatOnPaste: true,
                        formatOnType: true,
                        renderWhitespace: 'selection',
                        mouseWheelZoom: true
                    });
                    
                    // Listen for content changes
                    editor.onDidChangeModelContent(function() {
                        if (monacoInterface) {
                            const content = editor.getValue();
                            monacoInterface.update_content(content);
                        }
                    });
                    
                    // Notify that editor is ready
                    if (monacoInterface) {
                        monacoInterface.editor_initialized();
                    }
                    
                    // Focus the editor
                    editor.focus();
                });
                
            } catch (error) {
                showError('Failed to load Monaco Editor', error.message);
            }
        }
        
        function loadScript(src) {
            return new Promise((resolve, reject) => {
                const script = document.createElement('script');
                script.src = src;
                script.onload = resolve;
                script.onerror = reject;
                document.head.appendChild(script);
            });
        }
        
        function showError(title, message) {
            document.getElementById('container').innerHTML = `
                <div class="loading">
                    <div style="color: #d32f2f;">${title}</div>
                    <div style="font-size: 12px; margin-top: 10px;">${message}</div>
                </div>`;
        }
        
        // API functions called from Python
        function setEditorContent(content) {
            if (editor) {
                editor.setValue(content);
            }
        }
        
        function getEditorContent() {
            return editor ? editor.getValue() : '';
        }
        
        function setEditorLanguage(language) {
            if (editor) {
                const model = editor.getModel();
                monaco.editor.setModelLanguage(model, language);
            }
        }
        
        function setEditorTheme(theme) {
            if (editor) {
                monaco.editor.setTheme(theme);
            }
        }
        
        function setEditorOptions(options) {
            if (editor) {
                editor.updateOptions(options);
            }
        }
        
        function formatDocument() {
            if (editor) {
                editor.getAction('editor.action.formatDocument').run();
            }
        }
        
        function focusEditor() {
            if (editor) {
                editor.focus();
            }
        }
        
        function insertText(text) {
            if (editor) {
                const position = editor.getPosition();
                const range = new monaco.Range(
                    position.lineNumber, 
                    position.column, 
                    position.lineNumber, 
                    position.column
                );
                editor.executeEdits('insert-text', [{
                    range: range,
                    text: text
                }]);
            }
        }
        
        // Start initialization
        initMonaco();
    </script>
</body>
</html>
